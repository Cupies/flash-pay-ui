import{_ as B,d as N,r as i,h as S,k as r,o as v,b as k,w as a,l as o,c as $,F as C,C as h,a as f,p as L,E as V,i as R,L as O,G as q,t as D,e as P,H as E}from"./index-c4ccb8e7.js";import{b as F,g as W,e as T,a as z,f as j,h as A}from"./organization-8a6699c2.js";import{P as G}from"./index-06e87c0b.js";const H=N({name:"CreateMemberDialog",props:{dialogVisible:{type:Boolean,default:!1}},emits:["update:dialogVisible"],setup(e,{emit:l}){const _=i(e.dialogVisible),d=i({mobile:"",password:"",username:"",storeId:"",fullname:"",position:""}),b=i({username:""}),w=i([]),u=i([]),s=i([]),m=i([]);S(()=>e.dialogVisible,n=>{_.value=n});const g=()=>{c()},c=async()=>{try{u.value=await F();const n=await W(1,10,b.value);s.value=n.items}catch(n){console.error(n),V.error("获取数据失败")}};return{syncDialogVisible:_,form:d,memberFrom:b,memberList:w,roleList:u,storeList:s,rolecode:m,opend:g,getList:c,ensureDialog:async()=>{if(d.value.username===""||d.value.mobile===""||d.value.password===""||d.value.storeId===""||m.value.length===0){V.error("必填项不能为空");return}try{await T(d.value,m.value),l("update:dialogVisible",!1),V.success("添加成功"),d.value.mobile="",d.value.password="",d.value.username="",d.value.storeId="",d.value.fullname="",d.value.position="",m.value=[]}catch(n){console.error(n),V.error("添加失败")}}}}}),J={slot:"footer",class:"dialog-footer"};function K(e,l,_,d,b,w){const u=r("el-input"),s=r("el-form-item"),m=r("el-option"),g=r("el-select"),c=r("el-form"),p=r("el-button"),n=r("el-dialog");return v(),k(n,{title:"新增成员",visible:e.syncDialogVisible,onOpen:e.opend},{default:a(()=>[o(c,{inline:!1},{default:a(()=>[o(s,{label:"手机号: ","label-width":e.formLabelWidth,rules:[{required:!0}]},{default:a(()=>[o(u,{modelValue:e.form.mobile,"onUpdate:modelValue":l[0]||(l[0]=t=>e.form.mobile=t)},null,8,["modelValue"])]),_:1},8,["label-width"]),o(s,{label:"密码: ","label-width":e.formLabelWidth,rules:[{required:!0}]},{default:a(()=>[o(u,{modelValue:e.form.password,"onUpdate:modelValue":l[1]||(l[1]=t=>e.form.password=t)},null,8,["modelValue"])]),_:1},8,["label-width"]),o(s,{label:"用户名: ","label-width":e.formLabelWidth,rules:[{required:!0}]},{default:a(()=>[o(u,{modelValue:e.form.username,"onUpdate:modelValue":l[2]||(l[2]=t=>e.form.username=t)},null,8,["modelValue"])]),_:1},8,["label-width"]),o(s,{label:"姓名: ","label-width":e.formLabelWidth},{default:a(()=>[o(u,{modelValue:e.form.fullname,"onUpdate:modelValue":l[3]||(l[3]=t=>e.form.fullname=t)},null,8,["modelValue"])]),_:1},8,["label-width"]),o(s,{label:"职位: ","label-width":e.formLabelWidth},{default:a(()=>[o(u,{modelValue:e.form.position,"onUpdate:modelValue":l[4]||(l[4]=t=>e.form.position=t)},null,8,["modelValue"])]),_:1},8,["label-width"]),o(s,{label:"归属门店",rules:[{required:!0}]},{default:a(()=>[o(g,{modelValue:e.form.storeId,"onUpdate:modelValue":l[5]||(l[5]=t=>e.form.storeId=t),placeholder:"请选择"},{default:a(()=>[(v(!0),$(C,null,h(e.storeList,t=>(v(),k(m,{key:t.id,label:t.storeName,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(s,{label:"角色: ",rules:[{required:!0}]},{default:a(()=>[o(g,{modelValue:e.rolecode,"onUpdate:modelValue":l[6]||(l[6]=t=>e.rolecode=t),multiple:"",placeholder:"请选择"},{default:a(()=>[(v(!0),$(C,null,h(e.roleList,t=>(v(),k(m,{key:t.id,label:t.name,value:t.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),f("div",J,[o(p,{onClick:l[7]||(l[7]=t=>e.syncDialogVisible=!1)},{default:a(()=>[...l[8]||(l[8]=[L("取 消",-1)])]),_:1}),o(p,{type:"primary",onClick:e.ensureDialog},{default:a(()=>[...l[9]||(l[9]=[L("确 定",-1)])]),_:1},8,["onClick"])])]),_:1},8,["visible","onOpen"])}const Q=B(H,[["render",K]]),X=N({name:"MemberDialog",props:{dialogVisible:{type:Boolean,default:!1},memberIds:{type:String,default:""}},emits:["update:dialogVisible","update:memberIds"],setup(e,{emit:l}){const _=i(e.dialogVisible),d=i(e.memberIds),b=i({fullname:"",position:"",storeId:""}),w=i([]),u=i([]),s=i([]),m=i([]),g=i([]),c=i({username:""});S(()=>e.dialogVisible,y=>{_.value=y}),S(()=>e.memberIds,y=>{d.value=y});const p=()=>{n()},n=async()=>{try{const y=await z(1,10,c.value);u.value=y.items,s.value=u.value.filter(M=>d.value==M.id),m.value=await F();const I=await W(1,10,c.value);g.value=I.items,s.value.length>0&&(b.value.fullname=s.value[0].fullname,b.value.position=s.value[0].position)}catch(y){console.error(y),V.error("获取数据失败")}};return{syncDialogVisible:_,memberId:d,form:b,rolecode:w,listData:u,filterData:s,roleList:m,storeList:g,memberFrom:c,opend:p,getList:n,ensureDialog:async()=>{if(b.value.storeId===""||w.value.length===0){V.error("必填项不能为空");return}try{await j(b.value,w.value),l("update:dialogVisible",!1),V.success("修改成功")}catch(y){console.error(y),V.error("修改失败")}}}}}),Y={slot:"footer",class:"dialog-footer"};function Z(e,l,_,d,b,w){const u=r("el-input"),s=r("el-form-item"),m=r("el-option"),g=r("el-select"),c=r("el-form"),p=r("el-button"),n=r("el-dialog");return v(),k(n,{title:"新增成员",visible:e.syncDialogVisible,onOpen:e.opend},{default:a(()=>[o(c,{inline:!1},{default:a(()=>[o(s,{label:"姓名: ","label-width":e.formLabelWidth},{default:a(()=>[o(u,{modelValue:e.form.fullname,"onUpdate:modelValue":l[0]||(l[0]=t=>e.form.fullname=t)},null,8,["modelValue"])]),_:1},8,["label-width"]),o(s,{label:"职位: ","label-width":e.formLabelWidth},{default:a(()=>[o(u,{modelValue:e.form.position,"onUpdate:modelValue":l[1]||(l[1]=t=>e.form.position=t)},null,8,["modelValue"])]),_:1},8,["label-width"]),o(s,{label:"归属门店",rules:[{required:!0}]},{default:a(()=>[o(g,{modelValue:e.form.storeId,"onUpdate:modelValue":l[2]||(l[2]=t=>e.form.storeId=t),placeholder:"请选择"},{default:a(()=>[(v(!0),$(C,null,h(e.storeList,t=>(v(),k(m,{key:t.id,label:t.storeName,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(s,{label:"角色: ",rules:[{required:!0}]},{default:a(()=>[o(g,{modelValue:e.rolecode,"onUpdate:modelValue":l[3]||(l[3]=t=>e.rolecode=t),multiple:"",placeholder:"请选择"},{default:a(()=>[(v(!0),$(C,null,h(e.roleList,t=>(v(),k(m,{key:t.id,label:t.name,value:t.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),f("div",Y,[o(p,{onClick:l[4]||(l[4]=t=>e.syncDialogVisible=!1)},{default:a(()=>[...l[5]||(l[5]=[L("取 消",-1)])]),_:1}),o(p,{type:"primary",onClick:e.ensureDialog},{default:a(()=>[...l[6]||(l[6]=[L("确 定",-1)])]),_:1},8,["onClick"])])]),_:1},8,["visible","onOpen"])}const x=B(X,[["render",Z]]);const ee=N({name:"MemberList",components:{AddMember:Q,Pagination:G,UpdateMember:x},setup(){const e=i([]),l=i(1),_=i(10),d=i(!1),b=i(!1),w=i(0),u=i(""),s=i({username:""});R(()=>{m()});const m=async()=>{try{const n=await z(l.value,_.value,s.value);e.value=n.items,w.value=e.value.length,console.log(e.value)}catch(n){console.error(n),V.error("获取成员数据失败")}};return{list:e,pageNo:l,pageSize:_,dialogVisible:d,dialogVisible1:b,total:w,memberId:u,memberForm:s,getList:m,updateClick:n=>{console.log(n),u.value=n.id,b.value=!0},openSkuDialog:()=>{d.value=!0},deleteClick:async n=>{try{await A(n.id)?(V({message:"删除成功",type:"success",duration:2*1e3}),m()):V({message:"删除失败",type:"error",duration:2*1e3})}catch(t){console.error(t),V.error("删除成员失败")}}}}}),le={class:"data-container"},oe={"slot-scope":"scope"},te={"slot-scope":"scope"},ae={"slot-scope":"scope"},se={key:0},ne={"slot-scope":"scope"},re={"slot-scope":"scope"},ie={"slot-scope":"scope"},ue={"slot-scope":"scope"};function de(e,l,_,d,b,w){const u=r("el-button"),s=r("el-row"),m=r("el-input"),g=r("el-form-item"),c=r("el-form"),p=r("el-table-column"),n=r("el-table"),t=r("addMember"),y=r("updateMember"),I=r("pagination"),M=O("loading");return v(),$("div",le,[l[7]||(l[7]=f("h3",null,"成员管理",-1)),o(s,{type:"flex",justify:"end",class:"add"},{default:a(()=>[o(u,{type:"primary",size:"medium",onClick:e.openSkuDialog,id:"addBtn"},{default:a(()=>[...l[3]||(l[3]=[L("新增",-1)])]),_:1},8,["onClick"])]),_:1}),o(c,{inline:!0,size:"medium",class:"forms"},{default:a(()=>[o(g,{label:"账户/用户名:"},{default:a(()=>[o(m,{placeholder:"请输入",modelValue:e.memberForm.username,"onUpdate:modelValue":l[0]||(l[0]=U=>e.memberForm.username=U)},null,8,["modelValue"])]),_:1}),o(g,null,{default:a(()=>[o(u,{type:"primary",id:"searchBtn"},{default:a(()=>[...l[4]||(l[4]=[L("查询",-1)])]),_:1})]),_:1})]),_:1}),q((v(),k(n,{data:e.list,fit:"","highlight-current-row":"","header-cell-style":{color:"#5373e0",background:"#f3f6fb"},style:{width:"100%"}},{default:a(()=>[o(p,{align:"center",label:"成员序号"},{default:a(()=>[f("template",oe,[f("span",null,D(e.scope.$index+1),1)])]),_:1}),o(p,{align:"center",label:"账号"},{default:a(()=>[f("template",te,[f("span",null,D(e.scope.row.mobile),1)])]),_:1}),o(p,{align:"center",label:"用户名"},{default:a(()=>[f("template",ae,[e.scope.row.username?(v(),$("div",se,[f("span",null,D(e.scope.row.username),1)])):P("",!0)])]),_:1}),o(p,{align:"center",label:"所属门店"},{default:a(()=>[f("template",ne,[f("span",null,D(e.scope.row.storeId),1)])]),_:1}),o(p,{align:"center",label:"角色"},{default:a(()=>[f("template",re,[f("span",null,D(e.scope.row.position),1)])]),_:1}),o(p,{align:"center",label:"最后一次访问时间"},{default:a(()=>[f("template",ie,[f("span",null,D(e.scope.row.lastLoginTime),1)])]),_:1}),o(p,{fixed:"right",label:"操作",width:"120",align:"center"},{default:a(()=>[f("template",ue,[o(u,{onClick:l[1]||(l[1]=U=>e.updateClick(e.scope.row)),type:"text",size:"small"},{default:a(()=>[...l[5]||(l[5]=[L("编辑",-1)])]),_:1}),o(u,{onClick:l[2]||(l[2]=U=>e.deleteClick(e.scope.row)),type:"text",size:"small"},{default:a(()=>[...l[6]||(l[6]=[L("删除",-1)])]),_:1})])]),_:1})]),_:1},8,["data"])),[[M,e.listLoading]]),o(t,{dialogVisible:e.dialogVisible,onRefreshList:e.getList},null,8,["dialogVisible","onRefreshList"]),o(y,{dialogVisible:e.dialogVisible1,onRefreshList:e.getList,memberIds:e.memberId},null,8,["dialogVisible","onRefreshList","memberIds"]),q(o(I,{total:e.total,page:e.pageNo,limit:e.pageSize,onPagination:e.getList},null,8,["total","page","limit","onPagination"]),[[E,e.total>0]])])}const be=B(ee,[["render",de]]);export{be as default};
