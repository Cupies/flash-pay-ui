import{_ as te,F as be,m as p,o as k,b as Y,e as o,g as e,c as M,G as q,H as G,q as g,a as _,D as E,i as J,h as he,u as _e,r as s,I as L,k as ge,x as m,s as K,J as A,t as O}from"./index-dd519aa6.js";import{s as ee,a as Ve,b as Ce,c as Ie,u as we}from"./pay-12e95fdd.js";const Pe={name:"setParams",props:{dialogVisible:{type:Boolean,default:!1}},emits:["update:dialogVisible"],setup(u,{emit:l}){return{syncDialogVisible:be({get:()=>u.dialogVisible,set:a=>{l("update:dialogVisible",a)}})}}},ke={slot:"footer",class:"dialog-footer"};function xe(u,l,y,a,j,R){const v=p("el-input"),B=p("el-option"),d=p("el-select"),r=p("el-form-item"),c=p("el-button"),x=p("el-form"),b=p("el-dialog");return k(),Y(b,{title:"新增工单",visible:a.syncDialogVisible},{default:o(()=>[e(x,{ref:"form",model:u.form,"label-width":"140px"},{default:o(()=>[e(r,{label:"合作者身份PID: ",class:"firstItem"},{default:o(()=>[e(v,{placeholder:"请输入合作者身份PID"}),e(d,{modelValue:u.value,"onUpdate:modelValue":l[0]||(l[0]=h=>u.value=h),placeholder:"调用配置",class:"elSelect"},{default:o(()=>[(k(!0),M(q,null,G(u.options,h=>(k(),Y(B,{key:h.value,label:h.label,value:h.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"支付宝卖家账号: "},{default:o(()=>[e(v,{placeholder:"请输入支付宝卖家账号"})]),_:1}),e(r,{label:"安全校验码KEY: "},{default:o(()=>[e(v,{placeholder:"请输入安全校验码KEY"})]),_:1}),e(r,{label:"PSA私钥: "},{default:o(()=>[e(v,{placeholder:"请输入PSA私钥"})]),_:1}),e(r,{label:"支付宝APPID: "},{default:o(()=>[e(v,{placeholder:"请输入支付宝APPID"})]),_:1}),e(r,null,{default:o(()=>[e(c,{onClick:u.onSubmit,round:""},{default:o(()=>[...l[2]||(l[2]=[g("测试",-1)])]),_:1},8,["onClick"]),e(c,{type:"primary",onClick:u.onSubmit,round:""},{default:o(()=>[...l[3]||(l[3]=[g("保存",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"]),_("div",ke,[e(c,{onClick:l[1]||(l[1]=h=>a.syncDialogVisible=!1)},{default:o(()=>[...l[4]||(l[4]=[g("取 消",-1)])]),_:1}),e(c,{type:"primary",onClick:u.ensureDialog},{default:o(()=>[...l[5]||(l[5]=[g("确 定",-1)])]),_:1},8,["onClick"])])]),_:1},8,["visible"])}const Ue=te(Pe,[["render",xe]]),z=u=>E({url:`/merchant/my/pay-channel-params?tenantId=${J.tenantId}`,method:"post",data:u}),le=()=>E({url:`/merchant/my/platform-channels?tenantId=${J.tenantId}`,method:"get"}),ae=u=>E({url:`/merchant/my/pay-channel-params?tenantId=${J.tenantId}`,method:"put",data:u}),Se=(u,l,y)=>E({url:`/merchant/my/pay-channel-params/apps/${u}/platform-channels/${l}/pay-channels/${y}?tenantId=${J.tenantId}`,method:"get"}),De=u=>E({url:`/merchant/my/pay-channels/platform-channel/${u}?tenantId=${J.tenantId}`,method:"get"});const Ne={name:"set",components:{Setparams:Ue},setup(){const u=he(),l=_e(),y=s(0),a=s(!1),j=s(""),R=s(""),v=s(!0),B=s(!1),d=s([]),r=s([]),c=s(""),x=s(!1),b=s(!1),h=s(!1),S=s(!1),D=s(!1),t=s(!1),N=s([]),F=s([]),V=s(u.params.id||"0"),oe=s(u.params.step||"0"),I=s(""),H=s([]),T=s(""),Q=s([]),f=s({}),w=L({appId:"",rsaPrivateKey:"",notifyUrl:"",returnUrl:"",url:"https://openapi.alipaydev.com/gateway.do",chareset:"UTF-8",format:"json",alipayPublicKey:"",signtype:"RSA2"}),C=L({appID:"",appSecret:"",key:"",mchID:"",payKey:"",returnUrl:""}),P=L({appName:"",publicKey:"",merchantId:"",notifyUrl:"",appId:""}),U=L({appId:"",platformChannel:"",payChannel:""}),i=L({channelName:"",param:"",payChannel:"",platformChannelCode:"",appId:"",id:null}),ne=s([{value:"选项1",label:"支付宝web"},{value:"选项2",label:"微信移动端"}]);ge(()=>{y.value=Number(oe.value),V.value!=="0"&&(re(),I.value=V.value,X())});const X=async()=>{try{const n=await ee(V.value,"shanju_b2c");D.value=n!==0;const W=await ee(V.value,"shanju_c2b");t.value=W!==0,d.value=await le(),d.value.forEach($=>{$.state=$.channelCode==="shanju_b2c"?D.value:t.value})}catch{m.error("获取服务状态失败")}},re=async()=>{try{if(N.value=await Ve(),F.value=N.value.filter(n=>n.appId===V.value),F.value.length>0){const n=F.value[0];P.appName=n.appName,P.publicKey=n.publicKey,P.appId=n.appId,P.notifyUrl=n.notifyUrl,P.merchantId=n.merchantId}}catch{m.error("获取应用列表失败")}},se=async()=>{try{if(i.channelName=j.value,i.appId=I.value,i.payChannel=T.value,i.param=JSON.stringify(w),!w.appId||!w.rsaPrivateKey||!w.notifyUrl||!w.returnUrl||!w.alipayPublicKey){m.error("必填项不能为空!");return}V.value==="0"?(await z(i),m.success("添加成功!"),l.push("/pay/index")):Object.keys(f.value).length===0?(await z(i),m.success("添加成功!"),l.push("/pay/index")):(i.id=f.value.id,await ae(i),m.success("修改成功!"),l.push("/pay/index"))}catch{m.error("操作失败")}},de=async()=>{try{if(i.channelName=R.value,i.appId=I.value,i.payChannel=T.value,i.param=JSON.stringify(C),!C.appID||!C.appSecret||!C.key||!C.mchID||!C.payKey||!C.returnUrl){m.error("必填项不能为空!");return}V.value==="0"?(await z(i),m.success("添加成功!"),l.push("/pay/index")):Object.keys(f.value).length===0?(await z(i),m.success("添加成功!"),l.push("/pay/index")):(i.id=f.value.id,await ae(i),m.success("修改成功!"),l.push("/pay/index"))}catch{m.error("操作失败")}},ue=async n=>{try{n.state=!0,H.value=[n.channelCode],await Ce(I.value,H.value)}catch{m.error("开启服务失败")}},ie=async n=>{try{S.value=!0,T.value=n.channelCode,V.value!=="0"&&(U.appId=I.value,U.payChannel=T.value,f.value=await Se(U.appId,U.platformChannel,U.payChannel)),await nextTick(),n.channelCode==="WX_JSAPI"||n.channelCode==="WX_MICROPAY"?(Object.keys(f.value).length!==0&&n.channelCode===f.value.payChannel&&(R.value=f.value.channelName,Object.assign(C,JSON.parse(f.value.param))),h.value=!0):(Object.keys(f.value).length!==0&&n.channelCode===f.value.payChannel&&(j.value=f.value.channelName,Object.assign(w,JSON.parse(f.value.param))),h.value=!1)}catch{m.error("设置参数失败")}},me=()=>{a.value=!0},pe=async()=>{try{if(V.value==="0"){const n=await Ie(P);I.value=n.appId,Z()}else{const n=await we(P);I.value=n.appId,await X()}y.value=1}catch{m.error("保存失败")}},ce=()=>{y.value=2},fe=()=>{y.value=0},ye=async()=>{y.value=1,v.value=!0,S.value=!1,V.value!=="0"&&await X()},ve=()=>{y.value=2,v.value=!1},Z=async()=>{try{d.value=await le(),d.value.forEach(n=>{n.state=!1})}catch{m.error("获取服务类型失败")}};return{step:y,open:a,setName:j,setNames:R,godeploy:v,godeploys:B,options:ne,serveList:d,filterData:r,values:c,dialogVisible:x,realParam:b,form:w,wxform:C,realList:Q,code:T,appIds:I,payCodes:H,setParasData:i,forms:P,realForm:U,realParams:f,isWx:h,showParam:S,isB2c:D,isC2b:t,AllData:N,filterDatas:F,onSubmit:se,wxSubmit:de,startService:ue,setParam:ie,opens:me,save:pe,handleClicks:ce,goOne:fe,goTwo:ye,goThree:ve,getServeType:Z,setRealParams:async n=>{try{i.platformChannelCode=n.channelCode,U.platformChannel=n.channelCode,y.value=2,Q.value=await De(n.channelCode),b.value=n.channelCode==="shanju_c2b"}catch{m.error("设置真实参数失败")}}}}},Ke={class:"pay-container"},Ae={class:"oneStep"},Oe={class:"twoStep"},je={class:"threeStep"},Re={class:"setParams"},Be={class:"openBox"};function Te(u,l,y,a,j,R){const v=p("el-step"),B=p("el-steps"),d=p("el-input"),r=p("el-form-item"),c=p("el-button"),x=p("el-form"),b=p("el-table-column"),h=p("el-table"),S=p("el-option"),D=p("el-select");return k(),M("div",Ke,[l[24]||(l[24]=_("h3",null,"应用设置",-1)),e(B,{active:a.step,simple:"",style:{"margin-top":"20px"}},{default:o(()=>[e(v,{title:"基础信息",onClick:a.goOne},null,8,["onClick"]),e(v,{title:"服务类型",onClick:a.goTwo},null,8,["onClick"]),e(v,{title:"配置参数",onClick:a.goThree},null,8,["onClick"])]),_:1},8,["active"]),K(_("div",Ae,[e(x,{ref:"form",model:a.forms,"label-width":"120px"},{default:o(()=>[e(r,{label:"应用名称:"},{default:o(()=>[e(d,{placeholder:"请输入应用名称",modelValue:a.forms.appName,"onUpdate:modelValue":l[0]||(l[0]=t=>a.forms.appName=t)},null,8,["modelValue"])]),_:1}),e(r,{label:"应用公钥:"},{default:o(()=>[e(d,{placeholder:"请输入应用公钥",modelValue:a.forms.publicKey,"onUpdate:modelValue":l[1]||(l[1]=t=>a.forms.publicKey=t)},null,8,["modelValue"])]),_:1}),e(r,null,{default:o(()=>[e(c,{type:"primary",onClick:a.save,round:""},{default:o(()=>[...l[17]||(l[17]=[g("保存",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])],512),[[A,a.step===0]]),K(_("div",Oe,[e(h,{data:a.serveList,fit:"",border:"",stripe:"","highlight-current-row":"","header-cell-style":{color:"#5373e0",background:"#f3f6fb"},style:{width:"100%"}},{default:o(()=>[e(b,{align:"center",label:"支付ID"},{default:o(({row:t})=>[_("span",null,O(t.id),1)]),_:1}),e(b,{align:"center",label:"支付名称"},{default:o(({row:t})=>[_("span",null,O(t.channelName),1)]),_:1}),e(b,{align:"center",label:"支付编码"},{default:o(({row:t})=>[_("span",null,O(t.channelCode),1)]),_:1}),e(b,{fixed:"right",label:"操作",width:"300",align:"center"},{default:o(({row:t})=>[e(c,{onClick:N=>a.startService(t),type:"text",size:"small",disabled:t.state},{default:o(()=>[...l[18]||(l[18]=[g(" 开启服务 ",-1)])]),_:2},1032,["onClick","disabled"]),e(c,{onClick:N=>a.setRealParams(t),type:"text",size:"small",disabled:!t.state},{default:o(()=>[...l[19]||(l[19]=[g(" 配置实际支付渠道 ",-1)])]),_:2},1032,["onClick","disabled"])]),_:1})]),_:1},8,["data"])],512),[[A,a.step===1&&a.godeploy===!0]]),K(_("div",je,[e(h,{data:a.realList,fit:"",border:"",stripe:"","highlight-current-row":"","header-cell-style":{color:"#5373e0",background:"#f3f6fb"},style:{width:"100%"}},{default:o(()=>[e(b,{align:"center",label:"支付ID"},{default:o(({row:t})=>[_("span",null,O(t.id),1)]),_:1}),e(b,{align:"center",label:"支付名称"},{default:o(({row:t})=>[_("span",null,O(t.channelName),1)]),_:1}),e(b,{align:"center",label:"支付编码"},{default:o(({row:t})=>[_("span",null,O(t.channelCode),1)]),_:1}),e(b,{fixed:"right",label:"操作",width:"150",align:"center"},{default:o(({row:t})=>[e(c,{onClick:N=>a.setParam(t),type:"text",size:"small"},{default:o(()=>[...l[20]||(l[20]=[g("配置参数",-1)])]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),_("div",Re,[K(e(x,{ref:"form",model:a.form,"label-width":"140px"},{default:o(()=>[e(r,{label:"配置名称:",class:"firstItem"},{default:o(()=>[e(d,{placeholder:"请输入配置名称",modelValue:a.setName,"onUpdate:modelValue":l[2]||(l[2]=t=>a.setName=t)},null,8,["modelValue"]),e(D,{modelValue:a.values,"onUpdate:modelValue":l[3]||(l[3]=t=>a.values=t),placeholder:"调用配置",class:"elSelect"},{default:o(()=>[(k(!0),M(q,null,G(a.options,t=>(k(),Y(S,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"支付宝公钥:"},{default:o(()=>[e(d,{placeholder:"请输入支付宝公钥",modelValue:a.form.alipayPublicKey,"onUpdate:modelValue":l[4]||(l[4]=t=>a.form.alipayPublicKey=t)},null,8,["modelValue"])]),_:1}),e(r,{label:"APP私钥:"},{default:o(()=>[e(d,{placeholder:"请输入APP私钥",modelValue:a.form.rsaPrivateKey,"onUpdate:modelValue":l[5]||(l[5]=t=>a.form.rsaPrivateKey=t)},null,8,["modelValue"])]),_:1}),e(r,{label:"支付宝APPID:"},{default:o(()=>[e(d,{placeholder:"请输入支付宝APPID",modelValue:a.form.appId,"onUpdate:modelValue":l[6]||(l[6]=t=>a.form.appId=t)},null,8,["modelValue"])]),_:1}),e(r,{label:"同步通知地址:"},{default:o(()=>[e(d,{placeholder:"请输入同步通知地址",modelValue:a.form.returnUrl,"onUpdate:modelValue":l[7]||(l[7]=t=>a.form.returnUrl=t)},null,8,["modelValue"])]),_:1}),e(r,{label:"异步通知地址:"},{default:o(()=>[e(d,{placeholder:"请输入异步通知地址",modelValue:a.form.notifyUrl,"onUpdate:modelValue":l[8]||(l[8]=t=>a.form.notifyUrl=t)},null,8,["modelValue"])]),_:1}),e(r,{class:"btnParent"},{default:o(()=>[e(c,{type:"primary",onClick:a.onSubmit,round:"",class:"btn"},{default:o(()=>[...l[21]||(l[21]=[g("保存",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"]),[[A,!a.isWx&&a.showParam]]),K(e(x,{ref:"form",model:a.wxform,"label-width":"140px"},{default:o(()=>[e(r,{label:"配置名称:",class:"firstItem"},{default:o(()=>[e(d,{placeholder:"请输入配置名称",modelValue:a.setNames,"onUpdate:modelValue":l[9]||(l[9]=t=>a.setNames=t)},null,8,["modelValue"]),e(D,{modelValue:a.values,"onUpdate:modelValue":l[10]||(l[10]=t=>a.values=t),placeholder:"调用配置",class:"elSelect"},{default:o(()=>[(k(!0),M(q,null,G(a.options,t=>(k(),Y(S,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"微信appId:"},{default:o(()=>[e(d,{placeholder:"请输入appId",modelValue:a.wxform.appID,"onUpdate:modelValue":l[11]||(l[11]=t=>a.wxform.appID=t)},null,8,["modelValue"])]),_:1}),e(r,{label:"应用秘钥:"},{default:o(()=>[e(d,{placeholder:"请输入应用秘钥",modelValue:a.wxform.appSecret,"onUpdate:modelValue":l[12]||(l[12]=t=>a.wxform.appSecret=t)},null,8,["modelValue"])]),_:1}),e(r,{label:"微信安全码Key:"},{default:o(()=>[e(d,{placeholder:"请输入安全码",modelValue:a.wxform.key,"onUpdate:modelValue":l[13]||(l[13]=t=>a.wxform.key=t)},null,8,["modelValue"])]),_:1}),e(r,{label:"异步通知地址:"},{default:o(()=>[e(d,{placeholder:"请输入同步通知地址",modelValue:a.wxform.returnUrl,"onUpdate:modelValue":l[14]||(l[14]=t=>a.wxform.returnUrl=t)},null,8,["modelValue"])]),_:1}),e(r,{label:"商户ID:"},{default:o(()=>[e(d,{placeholder:"请输入合作者PID",modelValue:a.wxform.mchID,"onUpdate:modelValue":l[15]||(l[15]=t=>a.wxform.mchID=t)},null,8,["modelValue"])]),_:1}),e(r,{label:"支付秘钥:"},{default:o(()=>[e(d,{placeholder:"请输入支付秘钥",modelValue:a.wxform.payKey,"onUpdate:modelValue":l[16]||(l[16]=t=>a.wxform.payKey=t)},null,8,["modelValue"])]),_:1}),e(r,{class:"btnParent"},{default:o(()=>[e(c,{type:"primary",onClick:a.wxSubmit,round:"",class:"btn"},{default:o(()=>[...l[22]||(l[22]=[g("保存",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"]),[[A,a.isWx&&a.showParam]])])],512),[[A,a.step===2]]),K(_("div",Be,[e(c,{onClick:a.opens,type:"danger"},{default:o(()=>[...l[23]||(l[23]=[g("确认开启",-1)])]),_:1},8,["onClick"])],512),[[A,a.step===3&&!a.open]])])}const Fe=te(Ne,[["render",Te]]);export{Fe as default};
