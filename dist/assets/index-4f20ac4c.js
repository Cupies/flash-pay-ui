import{_ as J,d as W,o as i,c as L,a as d,n as N,b as F,w as n,e as k,u as X,f as Y,g as Z,r as a,h as _,i as x,j as ee,k as R,l as r,m as oe,p as B,q as M,t as P,E as p,s as se,v as le,x as re}from"./index-c4ccb8e7.js";const ae=W({name:"Login",setup(){const e=X(),o=Y(),U=Z(),m=a({usernames:"",password:""}),v=a({phone:"",code:"",smsKey:""}),f=a({mobile:"",username:"",password:"",verifiykey:"",verifiyCode:""}),u=a("password"),t=a(!1),V=a(!1),c=a(""),s=a({}),K=a(!1),S=a(!1),h=a("获取验证码"),b=a("获取验证码"),T=a(!0),g=a(60),I=a(!0),y=a(60);let w=null;_(()=>o,l=>{const C=l.query;C&&(c.value=C.redirect,s.value=H(C))},{immediate:!0,deep:!0}),x(()=>{}),ee(()=>{w&&clearInterval(w)});const $=()=>{K.value=!1},A=()=>{K.value=!0},D=()=>{S.value=!0},E=async()=>{if(v.value.phone===""){p({message:"手机号不能为空",type:"error",duration:2*1e3});return}if(I.value){I.value=!1,b.value=y.value+"s后重新发送",w=setInterval(()=>{y.value--,y.value>0&&(b.value=y.value+"s后重新发送"),y.value<=0&&(clearInterval(w),b.value="重新发送验证码",y.value=60,I.value=!0)},1e3);try{const l=await se(v.value.phone);v.value.smsKey=l}catch(l){console.error(l),p.error("获取验证码失败")}}},j=async()=>{if(f.value.mobile===""){p({message:"手机号不能为空",type:"error",duration:2*1e3});return}if(T.value){T.value=!1,h.value=g.value+"s后重新发送",w=setInterval(()=>{g.value--,g.value>0&&(h.value=g.value+"s后重新发送"),g.value<=0&&(clearInterval(w),h.value="重新发送验证码",g.value=60,T.value=!0)},1e3);try{const l=await le(f.value.mobile);f.value.verifiykey=l}catch(l){console.error(l),p.error("获取验证码失败")}}},O=async()=>{try{await re(f.value)?(p({message:"注册成功",type:"success",duration:2*1e3}),setTimeout(()=>{S.value=!1},2e3)):p({message:"注册失败",type:"error",duration:2*1e3})}catch(l){console.error(l),p.error("注册失败")}},Q=()=>{u.value==="password"?u.value="":u.value="password"},z=async()=>{if(localStorage.setItem("username",m.value.usernames),localStorage.setItem("password",m.value.password),m.value.usernames===""||m.value.password===""){p({message:"账号或密码不能为空",type:"error",duration:2*1e3});return}try{await U.Login(m.value),e.push({path:"/",query:s.value}),setTimeout(()=>{t.value=!1},500)}catch(l){console.error(l),t.value=!1}},G=async()=>{try{t.value=!0,await U.Logins(v.value),e.push({path:"/",query:s.value}),setTimeout(()=>{t.value=!1},500)}catch(l){console.error(l),t.value=!1}},H=l=>Object.keys(l).reduce((C,q)=>(q!=="redirect"&&(C[q]=l[q]),C),{});return{loginForm:m,loginForms:v,registryForm:f,passwordType:u,loading:t,showDialog:V,redirect:c,otherQuery:s,flag:K,isRegistry:S,content:h,codes:b,canClick:T,totalTime:g,canClicks:I,totalTimes:y,goAccount:$,goPhone:A,registry:D,getCodes:E,getCode:j,goRegistry:O,showPwd:Q,handleLogin:z,handleLogins:G}}}),te={class:"login-container"},ne={class:"loginbox"},ue={key:0,class:"rights"},ie={class:"title"},de={key:2,class:"bottom"},pe={key:1,class:"registryFrom"};function me(e,o,U,m,v,f){const u=R("el-input"),t=R("el-form-item"),V=R("el-button"),c=R("el-form");return i(),L("div",te,[d("div",ne,[e.isRegistry?k("",!0):(i(),L("div",ue,[d("p",ie,[d("span",{class:N([e.flag?"":"active","username"]),onClick:o[0]||(o[0]=(...s)=>e.goAccount&&e.goAccount(...s))},"账户密码登录",2),d("span",{class:N(["tel",e.flag?"active":""]),onClick:o[1]||(o[1]=(...s)=>e.goPhone&&e.goPhone(...s))},"手机号登录",2)]),e.flag?k("",!0):(i(),F(c,{key:0,ref:"loginForm",model:e.loginForm,class:"login-form",autocomplete:"on","label-position":"left"},{default:n(()=>[r(t,{prop:"username"},{default:n(()=>[r(u,{ref:"username",name:"username",modelValue:e.loginForm.usernames,"onUpdate:modelValue":o[2]||(o[2]=s=>e.loginForm.usernames=s),type:"text",autocomplete:"on",placeholder:"手机号/用户名"},null,8,["modelValue"])]),_:1}),r(t,{prop:"password"},{default:n(()=>[(i(),F(u,{key:e.passwordType,ref:"password",type:e.passwordType,modelValue:e.loginForm.password,"onUpdate:modelValue":o[3]||(o[3]=s=>e.loginForm.password=s),placeholder:"请输入密码",name:"password",autocomplete:"on",onKeyup:oe(e.handleLogin,["enter","native"])},null,8,["type","modelValue","onKeyup"]))]),_:1}),r(V,{type:"primary",style:{width:"100%","margin-top":"24px",height:"56px"},onClick:M(e.handleLogin,["prevent"])},{default:n(()=>[...o[13]||(o[13]=[B(" 登录 ",-1)])]),_:1},8,["onClick"])]),_:1},8,["model"])),e.flag?(i(),F(c,{key:1,ref:"loginForm",model:e.loginForm,class:"login-form",autocomplete:"on","label-position":"left"},{default:n(()=>[r(t,{prop:"username"},{default:n(()=>[r(u,{ref:"username",name:"username",modelValue:e.loginForms.phone,"onUpdate:modelValue":o[4]||(o[4]=s=>e.loginForms.phone=s),type:"text",autocomplete:"on",placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),r(t,{prop:"password"},{default:n(()=>[(i(),F(u,{key:e.passwordType,ref:"password",type:e.passwordType,modelValue:e.loginForms.code,"onUpdate:modelValue":o[5]||(o[5]=s=>e.loginForms.code=s),placeholder:"请输入验证码",name:"password",autocomplete:"on"},null,8,["type","modelValue"])),d("span",{class:"getCodes",onClick:o[6]||(o[6]=(...s)=>e.getCodes&&e.getCodes(...s))},P(e.codes),1)]),_:1}),r(V,{type:"primary",style:{width:"100%","margin-top":"24px",height:"56px"},onClick:M(e.handleLogins,["prevent"])},{default:n(()=>[...o[14]||(o[14]=[B(" 登录 ",-1)])]),_:1},8,["onClick"])]),_:1},8,["model"])):k("",!0),e.isRegistry?k("",!0):(i(),L("p",de,[d("span",{onClick:o[7]||(o[7]=(...s)=>e.registry&&e.registry(...s))},"注册账号")]))])),e.isRegistry?(i(),L("div",pe,[o[16]||(o[16]=d("p",{class:"registrys"},"注册账户",-1)),e.isRegistry?(i(),F(c,{key:0,"label-position":"left"},{default:n(()=>[r(t,null,{default:n(()=>[r(u,{modelValue:e.registryForm.username,"onUpdate:modelValue":o[8]||(o[8]=s=>e.registryForm.username=s),type:"text",placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),r(t,null,{default:n(()=>[r(u,{modelValue:e.registryForm.password,"onUpdate:modelValue":o[9]||(o[9]=s=>e.registryForm.password=s),placeholder:"请输入密码",type:"password"},null,8,["modelValue"])]),_:1}),r(t,null,{default:n(()=>[r(u,{modelValue:e.registryForm.mobile,"onUpdate:modelValue":o[10]||(o[10]=s=>e.registryForm.mobile=s),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),r(t,null,{default:n(()=>[r(u,{modelValue:e.registryForm.verifiyCode,"onUpdate:modelValue":o[11]||(o[11]=s=>e.registryForm.verifiyCode=s),placeholder:"请输入验证码"},null,8,["modelValue"]),d("span",{class:"getCode",onClick:o[12]||(o[12]=(...s)=>e.getCode&&e.getCode(...s))},P(e.content),1)]),_:1}),r(V,{type:"primary",style:{width:"100%","margin-top":"24px",height:"56px"},onClick:M(e.goRegistry,["prevent"])},{default:n(()=>[...o[15]||(o[15]=[B(" 注册 ",-1)])]),_:1},8,["onClick"])]),_:1})):k("",!0)])):k("",!0)])])}const ye=J(ae,[["render",me],["__scopeId","data-v-5dd5a1e9"]]);export{ye as default};
