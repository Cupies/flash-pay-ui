import{_ as de,d as me,o as f,c as H,a as s,w as U,n as P,b as D,e as a,f as R,g as t,E as ge,u as pe,h as ve,i as fe,r as n,j as x,k as ye,l as we,m as L,p as be,q as S,t as j,s as he,v as Fe,x as i,y as ke,z as _,A as Ce}from"./index-dd519aa6.js";const Pe=me({name:"Login",components:{ElDialog:ge},setup(){const e=pe(),o=ve(),O=fe(),y=n({usernames:"",password:""});x(y,l=>{console.log("loginForm 变化：",l)},{deep:!0});const g=n({phone:"",code:"",smsKey:""}),d=n({mobile:"",username:"",password:"",verifiykey:"",verifiyCode:""}),m=n("password"),u=n(!1),w=n(!1),b=n(""),V=n({}),r=n(!1),K=n(!1),M=n("获取验证码"),q=n("获取验证码"),z=n(!0),h=n(60),B=n(!0),F=n(60);let c=null;const G=n(!1),J=n(!1),W=n(!1),X=n(!1),T=n(""),E=n(!1),v=n(""),Q=n(""),N=n(""),I=n("获取验证码"),A=n(!0),k=n(60);let $=null;const ee=l=>Object.keys(l).reduce((p,Z)=>(Z!=="redirect"&&(p[Z]=l[Z]),p),{});x(()=>o,l=>{const p=l.query;p&&(b.value=p.redirect,V.value=ee(p))},{immediate:!0,deep:!0}),ye(()=>{}),we(()=>{c&&clearInterval(c),$&&clearInterval($)});const oe=()=>{r.value=!1},se=()=>{r.value=!0},re=()=>{K.value=!0},le=async()=>{if(g.value.phone===""){i({message:"手机号不能为空",type:"error",duration:2e3});return}if(!C(g.value.phone)){i({message:"请输入11位有效手机号",type:"error",duration:2e3});return}if(B.value){B.value=!1,q.value=F.value+"s后重新发送",c=setInterval(()=>{F.value--,F.value>0&&(q.value=F.value+"s后重新发送"),F.value<=0&&(clearInterval(c),q.value="重新发送验证码",F.value=60,B.value=!0)},1e3);try{const l=await ke(g.value.phone);g.value.smsKey=l}catch(l){console.error(l),i.error("获取验证码失败")}}},te=async()=>{if(d.value.mobile===""){i({message:"手机号不能为空",type:"error",duration:2e3});return}if(!C(d.value.mobile)){i({message:"请输入11位有效手机号",type:"error",duration:2e3});return}if(z.value){z.value=!1,M.value=h.value+"s后重新发送",c=setInterval(()=>{h.value--,h.value>0&&(M.value=h.value+"s后重新发送"),h.value<=0&&(clearInterval(c),M.value="重新发送验证码",h.value=60,z.value=!0)},1e3);try{const l=await _(d.value.mobile);d.value.verifiykey=l}catch(l){console.error(l),i.error("获取验证码失败")}}},Y=async()=>{if(W.value=!0,!d.value.username||d.value.username.length<4){i({message:"用户名需4-20位字符",type:"error",duration:2e3});return}if(!d.value.password||d.value.password.length<6){i({message:"密码需6-20位字符",type:"error",duration:2e3});return}if(!C(d.value.mobile)){i({message:"请输入11位有效手机号",type:"error",duration:2e3});return}if(!d.value.verifiyCode){i({message:"请输入验证码",type:"error",duration:2e3});return}if(!X.value){i({message:"请阅读并同意用户协议和隐私政策",type:"error",duration:2e3});return}try{await Ce(d.value)?(i({message:"注册成功，即将跳转登录",type:"success",duration:2e3}),setTimeout(()=>{K.value=!1,g.value.phone=d.value.mobile,r.value=!0},2e3)):i({message:"注册失败",type:"error",duration:2e3})}catch(l){console.error(l),i.error("注册失败")}},ne=()=>{m.value=m.value==="password"?"":"password"},ie=async()=>{if(G.value=!0,!y.value.usernames||!y.value.password){i({message:"账号或密码不能为空",type:"error",duration:2e3});return}u.value=!0,localStorage.setItem("username",y.value.usernames),localStorage.setItem("password",y.value.password);try{await O.Login(y.value),e.push({path:"/",query:V.value}),setTimeout(()=>u.value=!1,500)}catch(l){console.error(l),i.error("登录失败，请检查账号密码是否正确"),u.value=!1}},ae=async()=>{if(J.value=!0,!g.value.phone||!C(g.value.phone)){i({message:"请输入11位有效手机号",type:"error",duration:2e3});return}if(!g.value.code){i({message:"请输入验证码",type:"error",duration:2e3});return}try{u.value=!0,await O.Logins(g.value),e.push({path:"/",query:V.value}),setTimeout(()=>u.value=!1,500)}catch(l){console.error(l),i.error("登录失败，请检查验证码是否正确"),u.value=!1}},ue=()=>{e.push("/")},C=l=>/^1[3-9]\d{9}$/.test(l);return{loginForm:y,loginForms:g,registryForm:d,passwordType:m,loading:u,showDialog:w,redirect:b,otherQuery:V,flag:r,isRegistry:K,content:M,codes:q,canClick:z,totalTime:h,canClicks:B,totalTimes:F,goAccount:oe,goPhone:se,registry:re,getCodes:le,getCode:te,goRegistry:Y,showPwd:ne,handleLogin:ie,handleLogins:ae,isSubmitAccount:G,isSubmitPhone:J,isSubmitRegister:W,isAgree:X,pwdStrength:T,showForgotDialog:E,forgotPhone:v,forgotCode:Q,forgotPwd:N,forgotCodeText:I,canClickForgot:A,goHome:ue,isPhoneValid:C,formatPhone:l=>{if(!l)return;const p=l.replace(/\D/g,"");r.value&&(g.value.phone=p),K.value&&(d.value.mobile=p),E.value&&(v.value=p)},checkPwdStrength:l=>{if(l.length<6){T.value="";return}/^[0-9]+$/.test(l)||/^[a-zA-Z]+$/.test(l)?T.value="weak":/^[0-9a-zA-Z]+$/.test(l)?T.value="medium":T.value="strong"},showForgotPwd:()=>{E.value=!0,v.value="",Q.value="",N.value="",I.value="获取验证码",A.value=!0,k.value=60,$&&clearInterval($)},getForgotCode:async()=>{if(!v.value){i({message:"请输入手机号",type:"error",duration:2e3});return}if(!C(v.value)){i({message:"请输入11位有效手机号",type:"error",duration:2e3});return}if(A.value){A.value=!1,I.value=k.value+"s后重新发送",$=setInterval(()=>{k.value--,k.value>0&&(I.value=k.value+"s后重新发送"),k.value<=0&&(clearInterval($),I.value="重新发送验证码",k.value=60,A.value=!0)},1e3);try{const l=await _(v.value);i({message:"验证码已发送",type:"success",duration:2e3})}catch(l){console.error(l),i.error("获取验证码失败")}}},handleForgotSubmit:()=>{if(isSubmitForgot.value=!0,!v.value||!C(v.value)){i({message:"请输入11位有效手机号",type:"error",duration:2e3});return}if(!Q.value){i({message:"请输入验证码",type:"error",duration:2e3});return}if(!N.value||N.value.length<6){i({message:"新密码需6-20位字符",type:"error",duration:2e3});return}i({message:"密码重置成功，即将跳转登录",type:"success",duration:2e3}),setTimeout(()=>{E.value=!1,g.value.phone=v.value,r.value=!0},2e3)},handleRegisterSubmit:()=>{Y()}}}}),Se={class:"login-container"},Ve={class:"login-header"},ce={class:"loginbox"},$e={key:0,class:"rights"},Re={class:"tab-title"},Te={class:"input-wrapper"},Ie={class:"input-wrapper"},Ae=["title"],Ue={class:"input-wrapper"},De={class:"input-wrapper code-input-wrapper"},Le=["disabled"],Ke={class:"register-guide"},Me={key:1,class:"registryFrom"},qe={class:"register-header"},ze={class:"input-wrapper"},Be={class:"input-wrapper"},Ee=["title"],Ne={key:0,class:"pwd-strength"},He={class:"strength-bars"},je={class:"strength-level"},Oe={class:"input-wrapper"},Qe={class:"input-wrapper code-input-wrapper"},Ze=["disabled"],Ge={class:"agreement-label"},Je={class:"forgot-dialog-content"},We={class:"forgot-code-wrapper"},Xe=["disabled"],Ye={class:"dialog-footer"};function xe(e,o,O,y,g,d){const m=L("el-input"),u=L("el-form-item"),w=L("el-button"),b=L("el-form"),V=L("el-dialog");return f(),H("div",Se,[o[58]||(o[58]=s("div",{class:"login-bg-mask"},null,-1)),s("div",Ve,[s("a",{href:"/",class:"back-home",onClick:o[0]||(o[0]=U((...r)=>e.goHome&&e.goHome(...r),["prevent"]))},[...o[36]||(o[36]=[s("i",{class:"el-icon-arrow-left"},null,-1),s("span",null,"返回首页",-1)])])]),s("div",ce,[e.isRegistry?R("",!0):(f(),H("div",$e,[o[46]||(o[46]=s("div",{class:"login-header-group"},[s("h2",{class:"login-title"},"欢迎回来"),s("p",{class:"login-desc"},"请使用账号信息登录系统，开始您的操作")],-1)),s("p",Re,[s("span",{class:P([e.flag?"":"active","tab-item account-tab"]),onClick:o[1]||(o[1]=(...r)=>e.goAccount&&e.goAccount(...r))},"账户密码登录",2),s("span",{class:P(["tab-item phone-tab",e.flag?"active":""]),onClick:o[2]||(o[2]=(...r)=>e.goPhone&&e.goPhone(...r))},"手机号登录",2)]),e.flag?R("",!0):(f(),D(b,{key:0,ref:"loginFormAccount",model:e.loginForm,class:"login-form",autocomplete:"on","label-position":"left"},{default:a(()=>[t(u,{prop:"usernames",class:"form-item-custom",error:e.loginForm.usernames?"":e.isSubmitAccount?"请输入手机号或用户名":""},{default:a(()=>[s("div",Te,[o[37]||(o[37]=s("i",{class:"el-icon-user input-icon"},null,-1)),t(m,{ref:"username",name:"username",modelValue:e.loginForm.usernames,"onUpdate:modelValue":o[3]||(o[3]=r=>e.loginForm.usernames=r),type:"text",autocomplete:"on",placeholder:"手机号/用户名",class:"input-custom",onFocus:o[4]||(o[4]=r=>e.isSubmitAccount=!1)},null,8,["modelValue"])])]),_:1},8,["error"]),t(u,{prop:"password",class:"form-item-custom",error:e.loginForm.password?"":e.isSubmitAccount?"请输入密码":""},{default:a(()=>[s("div",Ie,[o[38]||(o[38]=s("i",{class:"el-icon-lock input-icon"},null,-1)),(f(),D(m,{key:e.passwordType,ref:"password",type:e.passwordType,modelValue:e.loginForm.password,"onUpdate:modelValue":o[5]||(o[5]=r=>e.loginForm.password=r),placeholder:"请输入密码",name:"password",autocomplete:"on",onKeyup:be(e.handleLogin,["enter","native"]),class:"input-custom",onFocus:o[6]||(o[6]=r=>e.isSubmitAccount=!1)},null,8,["type","modelValue","onKeyup"])),s("i",{class:P(["el-icon-view input-action-icon",e.passwordType==="password"?"":"el-icon-view-off"]),onClick:o[7]||(o[7]=(...r)=>e.showPwd&&e.showPwd(...r)),title:e.passwordType==="password"?"显示密码":"隐藏密码"},null,10,Ae)]),s("a",{href:"#",class:"forgot-pwd",onClick:o[8]||(o[8]=U((...r)=>e.showForgotPwd&&e.showForgotPwd(...r),["prevent"]))},"忘记密码？")]),_:1},8,["error"]),t(w,{type:"primary",class:"login-btn",onClick:U(e.handleLogin,["prevent"]),loading:e.loading,disabled:!e.loginForm.usernames||!e.loginForm.password},{default:a(()=>[...o[39]||(o[39]=[S(" 登录 ",-1)])]),_:1},8,["onClick","loading","disabled"]),o[40]||(o[40]=s("div",{class:"third-login"},[s("p",{class:"third-title"},"其他登录方式"),s("div",{class:"third-icons"},[s("a",{href:"#",class:"third-icon",title:"微信登录"},[s("i",{class:"el-icon-wechat"})]),s("a",{href:"#",class:"third-icon",title:"企业微信登录"},[s("i",{class:"el-icon-office-building"})]),s("a",{href:"#",class:"third-icon",title:"账号绑定"},[s("i",{class:"el-icon-link"})])])],-1))]),_:1},8,["model"])),e.flag?(f(),D(b,{key:1,ref:"loginFormPhone",model:e.loginForm,class:"login-form",autocomplete:"on","label-position":"left"},{default:a(()=>[t(u,{prop:"usernames",class:"form-item-custom",error:e.loginForms.phone?e.isPhoneValid(e.loginForms.phone)?"":"请输入11位有效手机号":e.isSubmitPhone?"请输入手机号":""},{default:a(()=>[s("div",Ue,[o[41]||(o[41]=s("i",{class:"el-icon-phone input-icon"},null,-1)),t(m,{ref:"username",name:"username",modelValue:e.loginForms.phone,"onUpdate:modelValue":o[9]||(o[9]=r=>e.loginForms.phone=r),type:"tel",autocomplete:"on",placeholder:"请输入手机号",class:"input-custom",onInput:o[10]||(o[10]=r=>e.formatPhone(e.loginForms.phone)),onFocus:o[11]||(o[11]=r=>e.isSubmitPhone=!1),maxlength:"11"},null,8,["modelValue"])])]),_:1},8,["error"]),t(u,{prop:"password",class:"form-item-custom code-item",error:e.loginForms.code?"":e.isSubmitPhone?"请输入验证码":""},{default:a(()=>[s("div",De,[o[42]||(o[42]=s("i",{class:"el-icon-message input-icon"},null,-1)),(f(),D(m,{key:e.passwordType,ref:"password",type:"text",modelValue:e.loginForms.code,"onUpdate:modelValue":o[12]||(o[12]=r=>e.loginForms.code=r),placeholder:"请输入6位验证码",name:"password",autocomplete:"on",onFocus:o[13]||(o[13]=r=>e.isSubmitPhone=!1),maxlength:"6",class:"input-custom"},null,8,["modelValue"]))]),s("button",{type:"button",class:"get-code-btn",onClick:o[14]||(o[14]=(...r)=>e.getCodes&&e.getCodes(...r)),disabled:!e.canClicks||!e.loginForms.phone||!e.isPhoneValid(e.loginForms.phone)},j(e.codes),9,Le)]),_:1},8,["error"]),t(w,{type:"primary",class:"login-btn",onClick:U(e.handleLogins,["prevent"]),loading:e.loading,disabled:!e.loginForms.phone||!e.loginForms.code||!e.isPhoneValid(e.loginForms.phone)},{default:a(()=>[...o[43]||(o[43]=[S(" 登录 ",-1)])]),_:1},8,["onClick","loading","disabled"]),o[44]||(o[44]=s("div",{class:"third-login"},[s("p",{class:"third-title"},"其他登录方式"),s("div",{class:"third-icons"},[s("a",{href:"#",class:"third-icon",title:"微信登录"},[s("i",{class:"el-icon-wechat"})]),s("a",{href:"#",class:"third-icon",title:"企业微信登录"},[s("i",{class:"el-icon-office-building"})]),s("a",{href:"#",class:"third-icon",title:"账号绑定"},[s("i",{class:"el-icon-link"})])])],-1))]),_:1},8,["model"])):R("",!0),s("div",Ke,[o[45]||(o[45]=s("span",{class:"guide-text"},"还没有账号？",-1)),s("button",{type:"button",class:"register-btn",onClick:o[15]||(o[15]=(...r)=>e.registry&&e.registry(...r))}," 立即注册 ")])])),e.isRegistry?(f(),H("div",Me,[s("div",qe,[o[48]||(o[48]=s("h2",{class:"register-title"},"创建新账号",-1)),s("button",{type:"button",class:"back-login-btn",onClick:o[16]||(o[16]=r=>e.isRegistry=!1),title:"返回登录"},[...o[47]||(o[47]=[s("i",{class:"el-icon-arrow-left"},null,-1)])])]),e.isRegistry?(f(),D(b,{key:0,"label-position":"left",class:"registry-form"},{default:a(()=>[t(u,{class:"form-item-custom",error:e.registryForm.username?e.registryForm.username.length>=4&&e.registryForm.username.length<=20?"":"用户名需4-20位字符":e.isSubmitRegister?"请输入用户名":""},{default:a(()=>[s("div",ze,[o[49]||(o[49]=s("i",{class:"el-icon-user input-icon"},null,-1)),t(m,{modelValue:e.registryForm.username,"onUpdate:modelValue":o[17]||(o[17]=r=>e.registryForm.username=r),type:"text",placeholder:"请输入用户名（4-20位字符）",class:"input-custom",onFocus:o[18]||(o[18]=r=>e.isSubmitRegister=!1),maxlength:"20"},null,8,["modelValue"])])]),_:1},8,["error"]),t(u,{class:"form-item-custom",error:e.registryForm.password?e.registryForm.password.length>=6&&e.registryForm.password.length<=20?"":"密码需6-20位字符":e.isSubmitRegister?"请输入密码":""},{default:a(()=>[s("div",Be,[o[50]||(o[50]=s("i",{class:"el-icon-lock input-icon"},null,-1)),t(m,{modelValue:e.registryForm.password,"onUpdate:modelValue":o[19]||(o[19]=r=>e.registryForm.password=r),placeholder:"请输入密码（6-20位字符）",type:"password",class:"input-custom",onFocus:o[20]||(o[20]=r=>e.isSubmitRegister=!1),onInput:o[21]||(o[21]=r=>e.checkPwdStrength(e.registryForm.password)),maxlength:"20"},null,8,["modelValue"]),s("i",{class:P(["el-icon-view input-action-icon",e.passwordType==="password"?"":"el-icon-view-off"]),onClick:o[22]||(o[22]=(...r)=>e.showPwd&&e.showPwd(...r)),title:e.passwordType==="password"?"显示密码":"隐藏密码"},null,10,Ee)]),e.registryForm.password?(f(),H("div",Ne,[o[51]||(o[51]=s("span",{class:"strength-text"},"密码强度：",-1)),s("div",He,[s("div",{class:P(["strength-bar",{weak:e.pwdStrength==="weak",medium:e.pwdStrength==="medium",strong:e.pwdStrength==="strong",active:e.pwdStrength!==""}])},null,2),s("div",{class:P(["strength-bar",{medium:e.pwdStrength==="medium",strong:e.pwdStrength==="strong",active:e.pwdStrength!==""&&e.pwdStrength!=="weak"}])},null,2),s("div",{class:P(["strength-bar",{strong:e.pwdStrength==="strong",active:e.pwdStrength==="strong"}])},null,2),s("span",je,j(e.pwdStrength==="weak"?"弱":e.pwdStrength==="medium"?"中":e.pwdStrength==="strong"?"强":""),1)])])):R("",!0)]),_:1},8,["error"]),t(u,{class:"form-item-custom",error:e.registryForm.mobile?e.isPhoneValid(e.registryForm.mobile)?"":"请输入11位有效手机号":e.isSubmitRegister?"请输入手机号":""},{default:a(()=>[s("div",Oe,[o[52]||(o[52]=s("i",{class:"el-icon-phone input-icon"},null,-1)),t(m,{modelValue:e.registryForm.mobile,"onUpdate:modelValue":o[23]||(o[23]=r=>e.registryForm.mobile=r),placeholder:"请输入手机号",type:"tel",class:"input-custom",onFocus:o[24]||(o[24]=r=>e.isSubmitRegister=!1),onInput:o[25]||(o[25]=r=>e.formatPhone(e.registryForm.mobile)),maxlength:"11"},null,8,["modelValue"])])]),_:1},8,["error"]),t(u,{class:"form-item-custom code-item",error:e.registryForm.verifiyCode?"":e.isSubmitRegister?"请输入验证码":""},{default:a(()=>[s("div",Qe,[o[53]||(o[53]=s("i",{class:"el-icon-message input-icon"},null,-1)),t(m,{modelValue:e.registryForm.verifiyCode,"onUpdate:modelValue":o[26]||(o[26]=r=>e.registryForm.verifiyCode=r),placeholder:"请输入6位验证码",class:"input-custom",onFocus:o[27]||(o[27]=r=>e.isSubmitRegister=!1),maxlength:"6"},null,8,["modelValue"])]),s("button",{type:"button",class:"get-code-btn",onClick:o[28]||(o[28]=(...r)=>e.getCode&&e.getCode(...r)),disabled:!e.canClick||!e.registryForm.mobile||!e.isPhoneValid(e.registryForm.mobile)},j(e.content),9,Ze)]),_:1},8,["error"]),t(u,{class:"agreement-item"},{default:a(()=>[s("label",Ge,[he(s("input",{type:"checkbox","onUpdate:modelValue":o[29]||(o[29]=r=>e.isAgree=r),class:"agreement-checkbox"},null,512),[[Fe,e.isAgree]]),o[54]||(o[54]=s("span",{class:"agreement-text"},[S(" 我已阅读并同意 "),s("a",{href:"#",class:"agreement-link"},"《用户服务协议》"),S(" 和 "),s("a",{href:"#",class:"agreement-link"},"《隐私政策》")],-1))])]),_:1}),t(w,{type:"primary",class:"login-btn",onClick:U(e.handleRegisterSubmit,["prevent"]),loading:e.loading,disabled:!e.registryForm.username||!e.registryForm.password||!e.registryForm.mobile||!e.registryForm.verifiyCode||!e.isAgree||!e.isPhoneValid(e.registryForm.mobile)},{default:a(()=>[...o[55]||(o[55]=[S(" 注册并登录 ",-1)])]),_:1},8,["onClick","loading","disabled"])]),_:1})):R("",!0)])):R("",!0)]),t(V,{title:"找回密码",visible:e.showForgotDialog,width:"400px",center:""},{footer:a(()=>[s("div",Ye,[t(w,{onClick:o[35]||(o[35]=r=>e.showForgotDialog=!1)},{default:a(()=>[...o[56]||(o[56]=[S("取消",-1)])]),_:1}),t(w,{type:"primary",onClick:e.handleForgotSubmit,disabled:!e.forgotPhone||!e.forgotCode||!e.forgotPwd||!e.isPhoneValid(e.forgotPhone)},{default:a(()=>[...o[57]||(o[57]=[S(" 确认重置 ",-1)])]),_:1},8,["onClick","disabled"])])]),default:a(()=>[s("div",Je,[t(b,{class:"forgot-form"},{default:a(()=>[t(u,{label:"手机号",error:e.forgotPhone?e.isPhoneValid(e.forgotPhone)?"":"请输入11位有效手机号":e.isSubmitForgot?"请输入手机号":""},{default:a(()=>[t(m,{modelValue:e.forgotPhone,"onUpdate:modelValue":o[30]||(o[30]=r=>e.forgotPhone=r),type:"tel",placeholder:"请输入手机号",onInput:o[31]||(o[31]=r=>e.formatPhone(e.forgotPhone)),maxlength:"11"},null,8,["modelValue"])]),_:1},8,["error"]),t(u,{label:"验证码",error:e.forgotCode?"":e.isSubmitForgot?"请输入验证码":""},{default:a(()=>[s("div",We,[t(m,{modelValue:e.forgotCode,"onUpdate:modelValue":o[32]||(o[32]=r=>e.forgotCode=r),placeholder:"请输入6位验证码",maxlength:"6"},null,8,["modelValue"]),s("button",{type:"button",class:"forgot-get-code",onClick:o[33]||(o[33]=(...r)=>e.getForgotCode&&e.getForgotCode(...r)),disabled:!e.canClickForgot||!e.forgotPhone||!e.isPhoneValid(e.forgotPhone)},j(e.forgotCodeText),9,Xe)])]),_:1},8,["error"]),t(u,{label:"新密码",error:e.forgotPwd?e.forgotPwd.length>=6&&e.forgotPwd.length<=20?"":"密码需6-20位字符":e.isSubmitForgot?"请输入新密码":""},{default:a(()=>[t(m,{modelValue:e.forgotPwd,"onUpdate:modelValue":o[34]||(o[34]=r=>e.forgotPwd=r),type:"password",placeholder:"请输入新密码",maxlength:"20"},null,8,["modelValue"])]),_:1},8,["error"])]),_:1})])]),_:1},8,["visible"])])}const no=de(Pe,[["render",xe],["__scopeId","data-v-dad7d91c"]]);export{no as default};
